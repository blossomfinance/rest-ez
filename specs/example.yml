meta:
  name: star wars api using yaml anchors
configuration:
  scheme: http
  host: swapi.dev
specs:

  # this does not actually run on its own
  - name: fetch film by film ID
    request:
      path: /api/films/{filmId}/
      method: get
      path_params:
        - name: filmId
          value: 1
    response:
      status_code: 200

  - name: fetch person for film 1 character 4
    request:
      path: /api/people/{personId}/
      method: get
    before_test:
      run_type: inline
      inline:
        function: !js/asyncFunction >
          async function() {
            var response = await this.runSpec('fetch film by film ID', {
              pathParams: 4
            });
            // title: A New Hope
            this.suite.film = JSON.parse(response.body);
            console.log('this.suite.film', this.suite.film)
            var characterUrl = this.suite.film.characters[4];
            var personId = characterUrl.match(/\/api\/people\/(\d+)\//)[1];
            this.test.path_params = { personId };
          }
    response:
      status_code: 200
      json_data:
        - path: $.name
          value: Leia Organa