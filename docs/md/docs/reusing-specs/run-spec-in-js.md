# Run Existing Specs Using JS

REST-EZ supports re-using specs & their result via the `this.runSpec()` method

<br><br>

## Spec in the Same Suite File

You can re-use an existing spec in your suite with JS:

```yaml | star-wars-api-using-spec-in-same-file.yml
meta:
  name: star wars api using yaml anchors
configuration:
  scheme: http
  host: swapi.dev
specs:
  - name: fetch film by film ID
    request:
      path: /api/films/{filmId}/
      method: get
      path_params:
        - name: filmId
          value: 1
    response:
      status_code: 200
  - name: fetch person for film 2
    request:
      path: /api/people/{personId}/
      method: get
    before_test:
      run_type: inline
      inline:
        function: !js/asyncFunction >
          async function() {
            var response = await this.runSpec('fetch film by film ID');
            // name: "A New Hope"
            this.suite.film = JSON.parse(response.body);
            var characterUrl = this.suite.film.characters[0];
            var personId = characterUrl.match(/\/api\/people\/(\d+)\//)[1];
            this.test.path_params = { personId };
          }
    response:
      status_code: 200
```

<br><br>

## Spec Within a Different Suite File

Intrasuite dependencies can be specified to allow using specs in a different suite

Use the `spec_dependencies` suite-level property to enable this. Paths are relative to current working directory of Node process.

> ‚ÑπÔ∏è NOTE: that these imported specs will only be available when you run them using `this.runSpec`.

<br><br>

> :Tabs
> > :Tab title=Suite Using a Dependency
> >
> > ```yaml | specs/new-suite.yml
> > meta:
> >   name: Suite Relying on a Dependency
> > spec_dependencies:
> >   - specs/existing-suite.yml
> > configuration:
> >   scheme: http
> >   host: swapi.dev
> > specs:
> >   - name: fetch person for film 2
> >   request:
> >     path: /api/people/{personId}/
> >     method: get
> >   before_test:
> >     run_type: inline
> >       inline:
> >         function: !js/asyncFunction >
> >           async function() {
> >             var response = await this.runSpec('fetch film by film ID');
> >             // name: "A New Hope"
> >             this.suite.film = JSON.parse(response.body);
> >             var characterUrl = this.suite.film.characters[0];
> >             var personId = characterUrl.match(/\/api\/people\/(\d+)\//)[1];
> >             this.test.path_params = { personId };
> >           }
> >   response:
> >     status_code: 200
> > ```
>
> > :Tab title=Suite with the Dependency
> > ```yaml | specs/existing-suite.yml
> > meta:
> >   name: Suite With an Existing Spec
> > configuration:
> >   scheme: http
> >   host: swapi.dev
> > specs:
> >   - name: fetch film by film ID
> >     request:
> >     path: /api/films/{filmId}/
> >     method: get
> >     path_params:
> >       - name: filmId
> >         value: 1
> >     response:
> >       status_code: 200
> > ```

<br><br>

> üí° To use a path relative to suite's path, use the [`locate_files_relative` parameter](/docs/basics/meta#locate_files_relative) of the suite [`meta` section](/docs/basics/meta).

<br><br>

**See also:** [Example: Run Specs from External File](https://github.com/matmar10/rest-ez/blob/master/test/cli/src/suites/suitedependencies/intersuitedeps.suite.yml)

<br><br>

## spec_dependencies

- Type: **array<string>** _optional_

Root-level suite property.

A list of file paths that this suite relies on to use `runSpec` method.

```yaml
spec_dependencies:
  - specs/some-suite.yml
  - specs/some-other-suite.yml
# ...
```

<br><br>

## The _runSpec_ Method

**runSpec(_name_, _options_)**

- **name** `string` _required_ Name of spec to run (identified by `name` property of the spec)
- **options** `object` _optional_  Override the original spec (e.g. `headers`, `query_params`, `path_params`, etc.)

Returns `Promise<Response>` The response generated by the spec

```javascript
/**
 * Run an existing spec in this suite
 * or an external suite connected via interspec_dependencies suite config
 *
 * @param {string} specName             Name of spec to run (identified by `name` property of the spec)
 * @param {object} options              Override the original spec
 * @param {string} options.path         The URL
 * @param {string} options.method       HTTP request method
 * @param {array} options.headers       Object of key/value pairs to set as headers
 * @param {array} options.path_params   Object of key/value pairs to set in the path
 * @param {array} options.query_params  Object of key/value pairs to add as query params ?name=value&name2=value2
 * @param {object} options.payload      Request body payload
 *
 * @return Promise<Response>
 */
function runSpec(specName, options) { }
```

```yaml | example-spec.yml
# ...
  - name: generate auth token
    request:
      path: /auth/login
      method: post
      payload:
        body:
          type: json
          content:
            email: foo@bar.com
            password: F2#@9!mls
    response:
      status_code: 201
      json_data:
        - name: $.token
          value: !!js/regexp /^[A-Z0-9]{32}$
  - name: fetch a person
    request:
      path: /user
      method: get
    before_test:
      run_type: inline
      inline:
        function: !js/asyncFunction >
          async function() {
            var response = await this.runSpec('generate auth token');
            var { token } = JSON.parse(response.body);
            this.test.headers = {
              'Authorization': `Bearer ${token}`
            };
          }
    response:
      status_code: 200
```